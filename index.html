<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Player Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
    <style>
        body, html { margin: 0; padding: 0; background: #000; height: 100vh; overflow: hidden; }
        #artplayer { width: 100vw; height: 100vh; }
        .skip-btn {
            position: absolute; bottom: 80px; right: 20px; z-index: 100;
            background: #ffad00; color: #000; padding: 12px 24px;
            font-family: sans-serif; font-weight: bold; cursor: pointer;
            display: none; border-radius: 4px; border: 1px solid white;
        }
    </style>
</head>
<body>

    <div id="artplayer"></div>
    <div id="skip-intro" class="skip-btn">SKIP INTRO</div>

    <script>
        // 1. API & Proxy Setup
        const PROXY = "https://proxy-pi-tawny.vercel.app/?url=";
        const M3U8_URL = "https://haildrop77.pro/_v7/b145d2374990ae1c6729b473457964247200b0c4dfc266cd896c13c16c62b0176c9ddc773b9ab8e9957c6579e5ef9fbc10c92eb2275126f9dfabd86d42fdf73dd879b9a87ced51fc2c6b8bb389fb2d1c2b0405a67f28128f230594972df9cb66945a5f8f51629dbade11b96c674a291037a95b568ad1a2c6d896d45252b299be/master.m3u8";

        // 2. Player Initialization
        const art = new Artplayer({
            container: '#artplayer',
            url: PROXY + encodeURIComponent(M3U8_URL),
            type: 'm3u8',
            autoplay: true,
            pip: false, // Turned off by default to fix your error
            fullscreen: true,
            setting: true,
            theme: '#ffad00',
            customType: {
                m3u8: function (video, url) {
                    if (Hls.isSupported()) {
                        const hls = new Hls({
                            // These settings help bypass minor network issues
                            xhrSetup: (xhr) => { xhr.withCredentials = false; },
                            manifestLoadingMaxRetry: 4
                        });
                        hls.loadSource(url);
                        hls.attachMedia(video);

                        // FIX: Only play when the video metadata is actually there
                        hls.on(Hls.Events.MANIFEST_PARSED, () => {
                            video.play().catch(() => {
                                art.notice.show = 'Click screen to start video';
                            });
                        });

                        // Error Recovery (Essential for HLS)
                        hls.on(Hls.Events.ERROR, (event, data) => {
                            if (data.fatal) {
                                hls.recoverMediaError();
                            }
                        });
                    }
                },
            },
        });

        // 3. Metadata Ready Event (Fixes your InvalidStateError)
        art.on('video:loadedmetadata', () => {
            console.log("Metadata loaded! PiP is now safe to use.");
            art.setting.update({ pip: true });
        });

        // 4. Skip Intro Logic (Hardcoded 0-89s for this example)
        const skipBtn = document.getElementById('skip-intro');
        art.on('video:timeupdate', () => {
            if (art.currentTime >= 0 && art.currentTime <= 89) {
                skipBtn.style.display = 'block';
            } else {
                skipBtn.style.display = 'none';
            }
        });

        skipBtn.onclick = () => {
            art.currentTime = 89;
            art.notice.show = 'Skipped Intro';
        };
    </script>
</body>
</html>
